<!DOCTYPE html>
<html lang="zh-CN" translate="no">
<head>ç°åœ¨ç»™è¿™ä¸ªä»£ç æ–°æ·»ä¸€ä¸ªè®¾ç½®åŠŸèƒ½ï¼Œè®¾ç½®åŠŸèƒ½åœ¨æœ€ä¸‹é¢ã€‚åœ¨ç‚¹è¿›è®¾ç½®åï¼Œç”¨æˆ·å¯ä»¥ä¿®æ”¹â€œå‘¼å«äº²å±â€â€œç¤¾åŒºåŒ»ç”Ÿâ€ã€â€œç‰©ä¸šè”ç³»â€çš„ç”µè¯å·ç ï¼Œä»¥åŠâ€œæˆ‘çš„åŸºç¡€ç—…â€ä¿¡æ¯ã€‚ä¿®æ”¹å¥½åï¼Œå°†å®ƒæ’å…¥è¿›ä¹‹å‰çš„ä»£ç æŠŠæ•´ä¸ªæ–°ä»£ç å‘ç»™æˆ‘
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1<!DOCTYPE html>
<html lang="zh-CN" translate="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>è€å¹´æ™ºèƒ½æ‰‹ç¯åŠ©æ‰‹</title>
    <style>
        /* æ–°å¢è®¾ç½®ç•Œé¢æ ·å¼ */
        .settings-form {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin: 20px auto;
            max-width: 500px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            font-size: 18px;
            margin-bottom: 8px;
            color: #333;
        }
        .form-input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
        }
        .save-btn {
            background: #27ae60;
            width: 100%;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ä¿®æ”¹ä¸»èœå•æ–°å¢è®¾ç½®æŒ‰é’® -->
        <section id="main-menu">
            <button class="menu-btn" onclick="showSection('emergency')">ç´§æ€¥æ±‚æ•‘</button>
            <button class="menu-btn" onclick="showSection('family')">å‘¼å«äº²å±</button>
            <button class="menu-btn" onclick="showSection('doctor')">ç¤¾åŒºåŒ»ç”Ÿ</button>
            <button class="menu-btn" onclick="showSection('property')">ç‰©ä¸šè”ç³»</button>
            <button class="menu-btn" onclick="showSection('ai-chat')">ä¸‡èƒ½é—®ç­”</button>
            <button class="menu-btn" onclick="showSection('medical')">æˆ‘çš„åŸºç¡€ç—…</button>
            <button class="menu-btn" onclick="showSection('settings')">âš™ï¸ ç³»ç»Ÿè®¾ç½®</button>
        </section>

        <!-- æ–°å¢è®¾ç½®ç•Œé¢ï¼ˆä½äºæ‰€æœ‰ç•Œé¢ä¹‹åï¼‰ -->
        <section id="settings" class="hidden">
            <h1 aria-label="ç³»ç»Ÿè®¾ç½®">âš™ï¸ ç³»ç»Ÿè®¾ç½®</h1>
            <div class="settings-form">
                <div class="form-group">
                    <label>äº²å±ç”µè¯å·ç ï¼š</label>
                    <input type="tel" id="family-number" class="form-input" 
                           placeholder="ä¾‹å¦‚ï¼š13800138000" pattern="[0-9-]+">
                </div>
                <div class="form-group">
                    <label>ç¤¾åŒºåŒ»ç”Ÿç”µè¯ï¼š</label>
                    <input type="tel" id="doctor-number" class="form-input"
                           placeholder="ä¾‹å¦‚ï¼š13900139000" pattern="[0-9-]+">
                </div>
                <div class="form-group">
                    <label>ç‰©ä¸šè”ç³»ç”µè¯ï¼š</label>
                    <input type="tel" id="property-number" class="form-input"
                           placeholder="ä¾‹å¦‚ï¼š010-12345678" pattern="[0-9-]+">
                </div>
                <div class="form-group">
                    <label>åŸºç¡€ç–¾ç—…ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰ï¼š</label>
                    <input type="text" id="medical-conditions" class="form-input"
                           placeholder="ä¾‹å¦‚ï¼šé«˜è¡€å‹,ç³–å°¿ç—…">
                </div>
                <div class="form-group">
                    <label>è¿‡æ•å²ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰ï¼š</label>
                    <input type="text" id="medical-allergies" class="form-input"
                           placeholder="ä¾‹å¦‚ï¼šé’éœ‰ç´ ,èŠ±ç²‰">
                </div>
                <div class="form-group">
                    <label>ç´§æ€¥è”ç³»äººï¼š</label>
                    <input type="text" id="emergency-contact" class="form-input"
                           placeholder="æ ¼å¼ï¼šå¼ åŒ»ç”Ÿ 13800138000">
                </div>

                <button class="menu-btn save-btn" onclick="saveSettings()">ğŸ’¾ ä¿å­˜è®¾ç½®</button>
                <button class="menu-btn back-btn" onclick="backToMenu()">â† è¿”å›ä¸»èœå•</button>
            </div>
        </section>

        <!-- åŸæœ‰å…¶ä»–ç•Œé¢ä¿æŒä¸å˜ -->
    </div>

    <script>
        // ================== æ–°å¢è®¾ç½®åŠŸèƒ½ ==================
        function loadSettings() {
            // åŠ è½½ç”µè¯å·ç è®¾ç½®
            const savedNumbers = JSON.parse(localStorage.getItem('phoneSettings')) || {};
            phoneNumbers.family = savedNumbers.family || '13800138000';
            phoneNumbers.doctor = savedNumbers.doctor || '13900139000';
            phoneNumbers.property = savedNumbers.property || '010-12345678';

            // åŠ è½½åŒ»ç–—ä¿¡æ¯
            const savedMedical = JSON.parse(localStorage.getItem('medicalInfo')) || {
                conditions: ["é«˜è¡€å‹", "ç³–å°¿ç—…"],
                allergies: ["é’éœ‰ç´ "],
                emergencyContact: "å¼ åŒ»ç”Ÿ 13800138000"
            };
            medicalInfo = savedMedical;

            // å¡«å……è®¾ç½®è¡¨å•
            document.getElementById('family-number').value = phoneNumbers.family;
            document.getElementById('doctor-number').value = phoneNumbers.doctor;
            document.getElementById('property-number').value = phoneNumbers.property;
            document.getElementById('medical-conditions').value = medicalInfo.conditions.join(",");
            document.getElementById('medical-allergies').value = medicalInfo.allergies.join(",");
            document.getElementById('emergency-contact').value = medicalInfo.emergencyContact;
        }

        function saveSettings() {
            // éªŒè¯å¹¶ä¿å­˜ç”µè¯å·ç 
            const newNumbers = {
                family: document.getElementById('family-number').value.trim(),
                doctor: document.getElementById('doctor-number').value.trim(),
                property: document.getElementById('property-number').value.trim()
            };

            const phoneRegex = /^(?:\+?86)?(?:1[3-9]\d{9}|0\d{2,3}-?\d{7,8})$/;
            for (const key in newNumbers) {
                if (!phoneRegex.test(newNumbers[key])) {
                    alert(`è¯·è¾“å…¥æœ‰æ•ˆçš„${getChineseName(key)}å·ç `);
                    return;
                }
            }

            // éªŒè¯å¹¶ä¿å­˜åŒ»ç–—ä¿¡æ¯
            const newMedical = {
                conditions: document.getElementById('medical-conditions').value.split(',').map(s => s.trim()),
                allergies: document.getElementById('medical-allergies').value.split(',').map(s => s.trim()),
                emergencyContact: document.getElementById('emergency-contact').value.trim()
            };

            if (newMedical.conditions.some(c => !c) || 
                newMedical.allergies.some(a => !a) || 
                !newMedical.emergencyContact) {
                alert("è¯·å¡«å†™å®Œæ•´çš„å¥åº·ä¿¡æ¯");
                return;
            }

            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('phoneSettings', JSON.stringify(newNumbers));
            localStorage.setItem('medicalInfo', JSON.stringify(newMedical));
            
            // æ›´æ–°è¿è¡Œæ—¶æ•°æ®
            Object.assign(phoneNumbers, newNumbers);
            medicalInfo = newMedical;
            
            // æ›´æ–°ç•Œé¢æ˜¾ç¤º
            updateMedicalDisplay();
            initCallSections(); // é‡æ–°åˆå§‹åŒ–å‘¼å«æŒ‰é’®
            alert("è®¾ç½®å·²ä¿å­˜ï¼");
            backToMenu();
        }

        function getChineseName(key) {
            return {
                family: 'äº²å±',
                doctor: 'ç¤¾åŒºåŒ»ç”Ÿ',
                property: 'ç‰©ä¸š'
            }[key];
        }

        // åˆå§‹åŒ–æ—¶åŠ è½½è®¾ç½®
        document.addEventListener('DOMContentLoaded', () => {
            loadSettings();
            initCallSections();
            speak("æ¬¢è¿ä½¿ç”¨æ™ºèƒ½æ‰‹ç¯åŠ©æ‰‹");
        });
        // ================== è®¾ç½®åŠŸèƒ½ç»“æŸ ==================
    </script>
</body>
</html>.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>è€å¹´æ™ºèƒ½æ‰‹ç¯åŠ©æ‰‹</title>
    <style>
        :root {
            --primary-color: #E74C3C;
            --secondary-color: #3498DB;
            --text-size: 24px;
        }

        body {
            font-family: "å¾®è½¯é›…é»‘", Arial, sans-serif;
            background: #F8F9FA;
            margin: 0;
            padding: 20px;
        }

        .menu-btn {
            display: block;
            width: 90%;
            margin: 15px auto;
            padding: 25px;
            font-size: var(--text-size);
            border-radius: 15px;
            border: none;
            background: var(--primary-color);
            color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .back-btn {
            background: #7F8C8D;
            width: 50%;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .hidden {
            display: none;
        }

        #ai-input {
            width: 80%;
            padding: 15px;
            font-size: 20px;
            margin: 20px 0;
        }

        #medical-info {
            background: #FFF3CD;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border: 1px solid #FFE699;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ä¸»èœå• -->
        <section id="main-menu">
            <button class="menu-btn" onclick="showSection('emergency')">ç´§æ€¥æ±‚æ•‘</button>
            <button class="menu-btn" onclick="showSection('family')">å‘¼å«äº²å±</button>
            <button class="menu-btn" onclick="showSection('doctor')">ç¤¾åŒºåŒ»ç”Ÿ</button>
            <button class="menu-btn" onclick="showSection('property')">ç‰©ä¸šè”ç³»</button>
            <button class="menu-btn" onclick="showSection('ai-chat')">ä¸‡èƒ½é—®ç­”</button>
            <button class="menu-btn" onclick="showSection('medical')">æˆ‘çš„åŸºç¡€ç—…</button>
        </section>

        <!-- ç´§æ€¥å‘¼å«ç•Œé¢ -->
        <section id="emergency" class="hidden">
            <h1 aria-label="ç´§æ€¥æ±‚æ•‘">ğŸ†˜ æ­£åœ¨å‘¼å«æ€¥æ•‘ä¸­å¿ƒ</h1>
            <button class="menu-btn" onclick="callNumber('120')">ç«‹å³æ‹¨æ‰“120</button>
            <button class="menu-btn back-btn" onclick="backToMenu()">â† è¿”å›ä¸»èœå•</button>
        </section>

        <!-- å…¶ä»–å‘¼å«ç•Œé¢æ¨¡æ¿ -->
        <template id="call-template">
            <h1></h1>
            <button class="menu-btn"></button>
            <button class="menu-btn back-btn">â† è¿”å›ä¸»èœå•</button>
        </template>

        <!-- AIé—®ç­”ç•Œé¢ -->
        <section id="ai-chat" class="hidden">
            <h1 aria-label="æ™ºèƒ½é—®ç­”">â“ ä¸‡èƒ½é—®ç­”åŠ©æ‰‹</h1>
            <input type="text" id="ai-input" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜...">
            <button class="menu-btn" onclick="getAIResponse()">æäº¤é—®é¢˜</button>
            <div id="ai-response" style="padding:20px;font-size:var(--text-size)"></div>
            <button class="menu-btn back-btn" onclick="backToMenu()">â† è¿”å›ä¸»èœå•</button>
        </section>

        <!-- åŸºç¡€ç—…ä¿¡æ¯ç•Œé¢ -->
        <section id="medical" class="hidden">
            <h1 aria-label="åŸºç¡€ç—…ä¿¡æ¯">ğŸ“‹ æˆ‘çš„å¥åº·æ¡£æ¡ˆ</h1>
            <div id="medical-info">
                <p>åŠ è½½ä¸­...</p>
            </div>
            <button class="menu-btn" onclick="editMedicalInfo()">ä¿®æ”¹ä¿¡æ¯</button>
            <button class="menu-btn back-btn" onclick="backToMenu()">â† è¿”å›ä¸»èœå•</button>
        </section>
    </div>

    <script>
        // ç”µè¯å·ç é…ç½®
        const phoneNumbers = {
            family: '13800138000',
            doctor: '13900139000',
            property: '010-12345678'
        }

        // åˆå§‹åŒ–åŒ»ç–—ä¿¡æ¯
        let medicalInfo = JSON.parse(localStorage.getItem('medicalInfo')) || {
            conditions: ["é«˜è¡€å‹", "ç³–å°¿ç—…"],
            allergies: ["é’éœ‰ç´ "],
            emergencyContact: "å¼ åŒ»ç”Ÿ 13800138000"
        }

        // ç•Œé¢åˆ‡æ¢æ§åˆ¶ï¼ˆæ·»åŠ é˜²æŠ¤æ€§æ£€æŸ¥ï¼‰
        function showSection(sectionId) {
            const sections = document.querySelectorAll('section');
            if (!sections) return;
            
            sections.forEach(s => {
                if (s.classList) s.classList.add('hidden');
            });

            const targetSection = document.getElementById(sectionId);
            if (targetSection && targetSection.classList) {
                targetSection.classList.remove('hidden');
                if(sectionId === 'medical') updateMedicalDisplay();
            }
        }

        function backToMenu() {
            showSection('main-menu');
        }

        // å¢å¼ºç‰ˆæ‹¨å·åŠŸèƒ½
        function callNumber(number) {
            const phoneRegex = /^(?:\+?86)?(?:1[3-9]\d{9}|0\d{2,3}-?\d{7,8})$/;
            
            if (!phoneRegex.test(number)) {
                alert("è¯·è¾“å…¥æœ‰æ•ˆçš„ç”µè¯å·ç \nç¤ºä¾‹ï¼š13800138000 æˆ– 010-12345678");
                speak("å·ç æ ¼å¼é”™è¯¯");
                return;
            }

            if (window.confirm(`ç¡®è®¤è¦æ‹¨æ‰“ ${number} å—ï¼Ÿ`)) {
                speak(`æ­£åœ¨æ‹¨æ‰“${number}`);
                window.location.href = `tel:${number}`;
            }
        }

        // è¯­éŸ³æç¤ºï¼ˆæ·»åŠ å®¹é”™æœºåˆ¶ï¼‰
        function speak(text) {
            try {
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'zh-CN';
                    window.speechSynthesis.speak(utterance);
                }
            } catch (e) {
                console.log('è¯­éŸ³åŠŸèƒ½ä¸å¯ç”¨:', e);
            }
        }

        // ä¼˜åŒ–åçš„AIé—®ç­”åŠŸèƒ½
        async function getAIResponse() {
            const question = document.getElementById('ai-input').value.trim();
            const responseBox = document.getElementById('ai-response');
            
            if (!question) {
                alert("è¯·è¾“å…¥æ‚¨çš„é—®é¢˜");
                return;
            }

            responseBox.innerHTML = '<div class="loading">æ€è€ƒä¸­...</div>';
            
            try {
                const response = await simulateAIResponse(question);
                responseBox.innerHTML = response;
                speak("å·²æ”¶åˆ°å›ç­”");
            } catch (error) {
                responseBox.innerHTML = 'æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•';
                speak("ç½‘ç»œè¿æ¥å¤±è´¥");
            }
        }

        // åŒ»ç–—ä¿¡æ¯ç®¡ç†ï¼ˆä¼˜åŒ–è¾“å…¥æ–¹å¼ï¼‰
        function editMedicalInfo() {
            const conditions = prompt("ç°æœ‰ç–¾ç—…ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰:", medicalInfo.conditions.join(","));
            const allergies = prompt("è¿‡æ•è¯ç‰©ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰:", medicalInfo.allergies.join(","));
            const contact = prompt("ç´§æ€¥è”ç³»äººåŠç”µè¯:", medicalInfo.emergencyContact);

            if (conditions && allergies && contact) {
                medicalInfo = {
                    conditions: conditions.split(",").map(s => s.trim()),
                    allergies: allergies.split(",").map(s => s.trim()),
                    emergencyContact: contact
                };
                localStorage.setItem('medicalInfo', JSON.stringify(medicalInfo));
                updateMedicalDisplay();
            }
        }

        // åˆå§‹åŒ–åŠ¨æ€å‘¼å«ç•Œé¢ï¼ˆä¿®å¤ç‰ˆï¼‰
        function initCallSections() {
            const template = document.getElementById('call-template');
            if (!template) return;

            ['family', 'doctor', 'property'].forEach(type => {
                const section = document.createElement('section');
                section.className = 'hidden';
                section.id = type;
                
                const clone = document.importNode(template.content, true);
                const title = clone.querySelector('h1');
                const button = clone.querySelector('.menu-btn');
                const backBtn = clone.querySelector('.back-btn');

                if (title && button && backBtn) {
                    title.textContent = `ğŸ“ æ­£åœ¨å‘¼å«${getTitle(type)}`;
                    button.textContent = `æ‹¨æ‰“ ${phoneNumbers[type]}`;
                    button.onclick = () => callNumber(phoneNumbers[type]);
                    backBtn.onclick = backToMenu;
                    section.appendChild(clone);
                    document.querySelector('.container').appendChild(section);
                }
            });
        }

        function getTitle(type) {
            return {
                family: 'äº²å±',
                doctor: 'ç¤¾åŒºåŒ»ç”Ÿ',
                property: 'ç‰©ä¸šæœåŠ¡'
            }[type];
        }

        // åˆå§‹åŒ–æ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', () => {
            initCallSections();
            speak("æ¬¢è¿ä½¿ç”¨æ™ºèƒ½æ‰‹ç¯åŠ©æ‰‹");
        });
    </script>
</body>
</html>
