<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è€å¹´æ™ºèƒ½æ‰‹ç¯åŠ©æ‰‹</title>
    <style>
        :root {
            --primary-color: #E74C3C;
            --secondary-color: #3498DB;
            --text-size: 24px;
        }

        body {
            font-family: "å¾®è½¯é›…é»‘", Arial, sans-serif;
            background: #F8F9FA;
            margin: 0;
            padding: 20px;
        }

        .menu-btn {
            display: block;
            width: 90%;
            margin: 15px auto;
            padding: 25px;
            font-size: var(--text-size);
            border-radius: 15px;
            border: none;
            background: var(--primary-color);
            color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .back-btn {
            background: #7F8C8D;
            width: 50%;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .hidden {
            display: none;
        }

        #ai-input {
            width: 80%;
            padding: 15px;
            font-size: 20px;
            margin: 20px 0;
        }

        #medical-info {
            background: #FFF3CD;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ä¸»èœå• -->
        <section id="main-menu">
            <button class="menu-btn" onclick="showSection('emergency')">ç´§æ€¥æ±‚æ•‘</button>
            <button class="menu-btn" onclick="showSection('family')">å‘¼å«äº²å±</button>
            <button class="menu-btn" onclick="showSection('doctor')">ç¤¾åŒºåŒ»ç”Ÿ</button>
            <button class="menu-btn" onclick="showSection('property')">ç‰©ä¸šè”ç³»</button>
            <button class="menu-btn" onclick="showSection('ai-chat')">ä¸‡èƒ½é—®ç­”</button>
            <button class="menu-btn" onclick="showSection('medical')">æˆ‘çš„åŸºç¡€ç—…</button>
        </section>

        <!-- ç´§æ€¥å‘¼å«ç•Œé¢ -->
        <section id="emergency" class="hidden">
            <h1 aria-label="ç´§æ€¥æ±‚æ•‘">ğŸ†˜ æ­£åœ¨å‘¼å«æ€¥æ•‘ä¸­å¿ƒ</h1>
            <button class="menu-btn" onclick="callNumber('120')">ç«‹å³æ‹¨æ‰“120</button>
            <button class="menu-btn back-btn" onclick="backToMenu()">è¿”å›</button>
        </section>

        <!-- å…¶ä»–å‘¼å«ç•Œé¢ï¼ˆæ¨¡æ¿ï¼‰ -->
        <template id="call-template">
            <h1></h1>
            <button class="menu-btn" onclick="callNumber('')">ç«‹å³æ‹¨æ‰“</button>
            <button class="menu-btn back-btn" onclick="backToMenu()">è¿”å›</button>
        </template>

        <!-- AIé—®ç­”ç•Œé¢ -->
        <section id="ai-chat" class="hidden">
            <h1 aria-label="æ™ºèƒ½é—®ç­”">â“ ä¸‡èƒ½é—®ç­”åŠ©æ‰‹</h1>
            <input type="text" id="ai-input" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜...">
            <button class="menu-btn" onclick="getAIResponse()">æäº¤é—®é¢˜</button>
            <div id="ai-response" style="padding:20px;font-size:var(--text-size)"></div>
            <button class="menu-btn back-btn" onclick="backToMenu()">è¿”å›</button>
        </section>

        <!-- åŸºç¡€ç—…ä¿¡æ¯ç•Œé¢ -->
        <section id="medical" class="hidden">
            <h1 aria-label="åŸºç¡€ç—…ä¿¡æ¯">ğŸ“‹ æˆ‘çš„å¥åº·æ¡£æ¡ˆ</h1>
            <div id="medical-info">
                <p>åŠ è½½ä¸­...</p>
            </div>
            <button class="menu-btn" onclick="editMedicalInfo()">ä¿®æ”¹ä¿¡æ¯</button>
            <button class="menu-btn back-btn" onclick="backToMenu()">è¿”å›</button>
        </section>
    </div>

    <script>
        // ç”µè¯å·ç é…ç½®
        const phoneNumbers = {
            family: '13800138000',  // æ›¿æ¢ä¸ºäº²å±ç”µè¯
            doctor: '13900139000',  // æ›¿æ¢ä¸ºç¤¾åŒºåŒ»ç”Ÿç”µè¯
            property: '010-12345678'  // æ›¿æ¢ä¸ºç‰©ä¸šç”µè¯
        }

        // åˆå§‹åŒ–åŒ»ç–—ä¿¡æ¯
        let medicalInfo = JSON.parse(localStorage.getItem('medicalInfo')) || {
            conditions: ["é«˜è¡€å‹", "ç³–å°¿ç—…"],
            allergies: ["é’éœ‰ç´ "],
            emergencyContact: "å¼ åŒ»ç”Ÿ 13800138000"
        }

        // ç•Œé¢åˆ‡æ¢æ§åˆ¶
        function showSection(sectionId) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'))
            document.getElementById(sectionId).classList.remove('hidden')
            
            if(sectionId === 'medical') {
                updateMedicalDisplay()
            }
        }

        function backToMenu() {
            showSection('main-menu')
        }

        // æ‹¨å·åŠŸèƒ½
        function callNumber(number) {
            speak(`æ­£åœ¨æ‹¨æ‰“${number}`)
            window.location.href = `tel:${number}`
        }

        // è¯­éŸ³æç¤º
        function speak(text) {
            const synth = window.speechSynthesis
            const utterance = new SpeechSynthesisUtterance(text)
            utterance.lang = 'zh-CN'
            synth.speak(utterance)
        }

        // AIé—®ç­”åŠŸèƒ½ï¼ˆéœ€æ›¿æ¢ä¸ºçœŸå®APIï¼‰
        async function getAIResponse() {
            const question = document.getElementById('ai-input').value
            const responseBox = document.getElementById('ai-response')
            
            responseBox.innerHTML = 'æ€è€ƒä¸­...'
            
            try {
                // ç¤ºä¾‹ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼Œå®é™…åº”æ›¿æ¢ä¸ºAPIè°ƒç”¨
                const response = await simulateAIResponse(question)
                responseBox.innerHTML = response
                speak("å·²æ”¶åˆ°å›ç­”")
            } catch (error) {
                responseBox.innerHTML = 'æš‚æ—¶æ— æ³•å›ç­”é—®é¢˜ï¼Œè¯·ç¨åå†è¯•'
                speak("ç½‘ç»œè¿æ¥å¤±è´¥")
            }
        }

        async function simulateAIResponse(question) {
            // æ¨¡æ‹Ÿå»¶è¿Ÿ
            await new Promise(resolve => setTimeout(resolve, 1000))
            
            // ç®€å•å…³é”®è¯åŒ¹é…
            const responses = {
                "è¯": "è¯·æŒ‰ç…§åŒ»ç”Ÿå˜±å’å®šæ—¶æœè¯ï¼Œä¸è¦è‡ªè¡Œè°ƒæ•´å‰‚é‡",
                "ç–¼": "å¦‚æœæŒç»­ç–¼ç—›ï¼Œè¯·ç«‹å³è”ç³»æ‚¨çš„å®¶åº­åŒ»ç”Ÿ",
                "é»˜è®¤": "æˆ‘å·²è®°å½•æ‚¨çš„é—®é¢˜ï¼Œç¨åä¼šæœ‰ä¸“äººè”ç³»æ‚¨è§£ç­”"
            }

            return Object.keys(responses).find(key => question.includes(key)) 
                   ? responses[Object.keys(responses).find(key => question.includes(key))] 
                   : responses['é»˜è®¤']
        }

        // åŒ»ç–—ä¿¡æ¯ç®¡ç†
        function updateMedicalDisplay() {
            const infoBox = document.getElementById('medical-info')
            infoBox.innerHTML = `
                <h2>ç°æœ‰åŸºç¡€ç–¾ç—…</h2>
                <ul>
                    ${medicalInfo.conditions.map(c => `<li>${c}</li>`).join('')}
                </ul>
                <h2>è¿‡æ•å²</h2>
                <ul>
                    ${medicalInfo.allergies.map(a => `<li>${a}</li>`).join('')}
                </ul>
                <h2>ç´§æ€¥è”ç³»äºº</h2>
                <p>${medicalInfo.emergencyContact}</p>
            `
        }

        function editMedicalInfo() {
            // æ­¤å¤„å¯æ‰©å±•ä¸ºè¡¨å•ç¼–è¾‘åŠŸèƒ½
            const newInfo = prompt("è¯·è¾“å…¥æ›´æ–°åçš„åŒ»ç–—ä¿¡æ¯ï¼ˆJSONæ ¼å¼ï¼‰", JSON.stringify(medicalInfo))
            try {
                medicalInfo = JSON.parse(newInfo)
                localStorage.setItem('medicalInfo', newInfo)
                updateMedicalDisplay()
            } catch {
                alert("è¾“å…¥æ ¼å¼é”™è¯¯")
            }
        }

        // åˆå§‹åŒ–åŠ¨æ€å‘¼å«ç•Œé¢
        function initCallSections() {
            const template = document.getElementById('call-template')
            
            ;['family', 'doctor', 'property'].forEach(type => {
                const section = document.createElement('section')
                section.className = 'hidden'
                section.id = type
                section.innerHTML = template.innerHTML
                section.querySelector('h1').textContent = `ğŸ“ æ­£åœ¨å‘¼å«${getTitle(type)}`
                section.querySelector('button').onclick = () => callNumber(phoneNumbers[type])
                document.querySelector('.container').appendChild(section)
            })
        }

        function getTitle(type) {
            return {
                family: 'äº²å±',
                doctor: 'ç¤¾åŒºåŒ»ç”Ÿ',
                property: 'ç‰©ä¸šæœåŠ¡'
            }[type]
        }

        // åˆå§‹åŒ–æ‰§è¡Œ
        initCallSections()
        speak("æ¬¢è¿ä½¿ç”¨æ™ºèƒ½æ‰‹ç¯åŠ©æ‰‹")
    </script>
</body>
</html>
